---
title: "Checkpoint"
output: html_document
date: "2024-07-08"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(ggplot2)
library(factoextra)
library(patchwork)
```

# Determining Optimal Number of Cluster (Not Doing PCA First)

Prepping Lung Data 
```{r lung data for elbows}
lung_meta40 <- read.csv("lung_meta40.csv")
lung_meta30 <- read.csv("lung_meta30.csv")
lung_meta20 <- read.csv("lung_meta20.csv")

#removing all columns except the k-value ones 
new_lung_meta40 = subset(lung_meta40, select = -c(X, image_id, patient_id, gender, mhcII_status, age_at_diagnosis, stage_at_diagnosis, stage_numeric, pack_years, survival_days, survival_status, cause_of_death, adjuvant_therapy, time_to_recurrence_days, recurrence_or_lung_ca_death, totalCell))

new_lung_meta30 = subset(lung_meta30, select = -c(X, image_id, patient_id, gender, mhcII_status, age_at_diagnosis, stage_at_diagnosis, stage_numeric, pack_years, survival_days, survival_status, cause_of_death, adjuvant_therapy, time_to_recurrence_days, recurrence_or_lung_ca_death, totalCell))

new_lung_meta20 = subset(lung_meta20, select = -c(X, image_id, patient_id, gender, mhcII_status, age_at_diagnosis, stage_at_diagnosis, stage_numeric, pack_years, survival_days, survival_status, cause_of_death, adjuvant_therapy, time_to_recurrence_days, recurrence_or_lung_ca_death, totalCell))

# removing all the na entries 
new_lung_meta40 = na.omit(new_lung_meta40)
new_lung_meta30 = na.omit(new_lung_meta30)
new_lung_meta20 = na.omit(new_lung_meta20)

# scaling the data 
new_lung_meta40 = scale(new_lung_meta40)
new_lung_meta30 = scale(new_lung_meta30)
new_lung_meta20 = scale(new_lung_meta20)

```


```{r lung number clusters}
# width sum of squares method (elbow plot)
wss_lung = fviz_nbclust(new_lung_meta40, kmeans, method = "wss")

# silhouette method
silhouette_lung = fviz_nbclust(new_lung_meta40, kmeans, method = "silhouette")

# gap statistic method 
gap_stat_lung = fviz_nbclust(new_lung_meta40, kmeans, method = "gap_stat")
wss_lung + silhouette_lung + gap_stat_lung

```


Now doing the same for the ovarian data:
Prepping ovarian data 
```{r ova data for elbow}
ovarian_meta40 <- read.csv("ovarian_meta40.csv")
ovarian_meta30 <- read.csv("ovarian_meta30.csv")
ovarian_meta20 <- read.csv("ovarian_meta20.csv")

new_ovarian_meta40 = subset(ovarian_meta40, select = -c(sample_id, tma, diagnosis, primary, recurrent, treatment_effect, stage, grade, survival_time, death, BRCA_mutation, age_at_diagnosis, time_to_recurrence, parpi_inhibitor, debulking, totalCell, p_Other, p_Tumor, p_BCell, p_Macrophage, p_THelper, p_CytotoxicT))

new_ovarian_meta30 = subset(ovarian_meta30, select = -c(sample_id, tma, diagnosis, primary, recurrent, treatment_effect, stage, grade, survival_time, death, BRCA_mutation, age_at_diagnosis, time_to_recurrence, parpi_inhibitor, debulking, totalCell, p_Other, p_Tumor, p_BCell, p_Macrophage, p_THelper, p_CytotoxicT))

new_ovarian_meta20 = subset(ovarian_meta20, select = -c(sample_id, tma, diagnosis, primary, recurrent, treatment_effect, stage, grade, survival_time, death, BRCA_mutation, age_at_diagnosis, time_to_recurrence, parpi_inhibitor, debulking, totalCell, p_Other, p_Tumor, p_BCell, p_Macrophage, p_THelper, p_CytotoxicT))

new_ovarian_meta40 = na.omit(new_ovarian_meta40)
new_ovarian_meta30 = na.omit(new_ovarian_meta30)
new_ovarian_meta20 = na.omit(new_ovarian_meta20)

new_ovarian_meta40 = scale(new_ovarian_meta40)
new_ovarian_meta30 = scale(new_ovarian_meta30)
new_ovarian_meta20 = scale(new_ovarian_meta20)
```


```{r ova number clusters}
# width sum of squares method (elbow plot)
wss_ova = fviz_nbclust(new_ovarian_meta40, kmeans, method = "wss")

# silhouette method
silhouette_ova = fviz_nbclust(new_ovarian_meta40, kmeans, method = "silhouette")

# gap statistic method 
gap_stat_ova = fviz_nbclust(new_ovarian_meta40, kmeans, method = "gap_stat")

wss_ova + silhouette_ova + gap_stat_ova
```


# Determining Optimal Number of Clusters (After PCA) 
```{r lung number}
# with 8 pcs 
wss_pc8_lung = fviz_nbclust(lung_transform, kmeans, method = "wss")

silhouette_pc8_lung = fviz_nbclust(lung_transform, kmeans, method = "silhouette")

gap_stat_pc8_lung = fviz_nbclust(lung_transform, kmeans, method = "gap_stat")

wss_pc8_lung + silhouette_pc8_lung + gap_stat_pc8_lung

# with 3 pcs
wss_pc3_lung = fviz_nbclust(lung_transform3, kmeans, method = "wss")

silhouette_pc3_lung = fviz_nbclust(lung_transform3, kmeans, method = "silhouette")

gap_stat_pc3_lung = fviz_nbclust(lung_transform3, kmeans, method = "gap_stat")

wss_pc3_lung + silhouette_pc3_lung + gap_stat_pc3_lung
```

```{r ova number}

```

